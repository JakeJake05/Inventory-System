@using InventorySystem.Models.DataEntities
@model Item;

@{
    ViewData["Title"] = "Modify";
    //bool isCreationContext = ViewData["IsCreationContext"] is bool value && value;
    //var isCreationContext = ViewData["IsCreationContext"] != null && (bool)ViewData["IsCreationContext"];
    Layout = null;
}

<script>

    var itemid = '@Html.Raw(Model.ItemCode)';
    $(document).on('hidden.bs.modal', '.container #dynamic-modal', function (e) {
      $(this).remove();
    });


    $(document).ready(function () {
        getStatuses();
        getOptions();
        checkcodechanges();

        $('#updatecode').on('input', function () {
            checkcodechanges();
        });
    });

    
    function checkcodechanges(){
        var currentcode = $('#updatecode').val();

        if (currentcode !== itemid) {
           
            $('.previous-id').text('Previous Id: ' + itemid);
        } else{
            $('.previous-id').text('No changes');
        }
    }

</script>

<style>
    .update{
        font-size: 0.7rem;
    }
</style>

<h5><strong>Modify Details</strong></h5>
<hr />
<form asp-controller="ValidateApi" asp-action="UpdateItem" asp-route-id="@Model.ItemId" id="update-form" class="forms" method="post" onsubmit="return UpdateRequest(this);">
    <input hidden asp-for="@Model.ItemId" id="dataid" name="dataid"/>
    <div class="form-group">
        <label asp-for="ItemCode" class="control-label"></label>
        <div class="input-group">
            <input asp-for="ItemCode" type="text" class="form-control user-input update" autocomplete="off"
                   name="updatecode"
                   id="updatecode"
                   required
                   data-val="true"
                   data-val-required="Item code is required!"
                   data-val-minlength="Item code must be at least 3 characters long."
                   data-val-minlength-min="3"
                   maxlength="20" pattern="\S+" onkeydown="if(['Space'].includes(arguments[0].code)){return false;}" />
            <div class="input-group-append">
                <div class="input-group-text previous-id text-muted update">

                </div>
            </div>

        </div>
        <span asp-validation-for="ItemCode" id="updatecode-error" class="text-danger"></span>
    </div>

    <div class="form-group mt-2">
        <label asp-for="ItemName" class="control-label"></label>
        <input asp-for="ItemName" type="text" class="form-control user-input update" autocomplete="off"
               name="updatename" 
               id="updatename"
               required
               data-val="true"
               data-val-required="Item name is required!"
               data-val-minlength="Item name must be at least 3 characters long."
               data-val-minlength-min="3"
               maxlength="20" />
        <span asp-validation-for="ItemName" id="updatename-error" class="text-danger"></span>
    </div>

    <div class="form-group mt-2">
        <label asp-for="ItemDescription" class="control-label"></label>
        <textarea asp-for="ItemDescription" type="text" class="form-control user-input update" autocomplete="off"
               name="updatedesc" 
               id="updatedesc" 
               maxlength="5000">
        </textarea>
        <span asp-validation-for="ItemDescription" id="updatedesc-error" class="text-danger"></span>
    </div>

    <div class="form-group mt-2">
        <label asp-for="Status" class="control-label"></label>
        <select asp-for="Status" id="updatestatus" class="form-control update" required name="updatestatus">
            <option value="" class="text-muted">--Select Status--</option>
        </select>

        <span asp-validation-for="Status" id="updatestatus-errror" class="text-danger"></span>
    </div>

    <div class="form-group mt-2">
        <label asp-for="FirmwareUpdated" class="control-label"></label>
        <select asp-for="FirmwareUpdated" id="updatefirmware" class="form-control update" required name="updatefirmware">
            <option value="" class="text-muted">--Select Option--</option>
        </select>

        <span asp-validation-for="FirmwareUpdated" id="updatefirmware-error" class="text-danger"></span>
    </div>


    <div class="form-group mt-3">
        <input type="submit" value="Save Changes" class="btn btn-primary form-control" />
        <input type="button" value="Cancel" class="btn btn-outline-secondary form-control mt-3 close-modalBtn" data-bs-dismiss="modal" />
    </div>
</form>

