@model ItemListViewModel
@{
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
    var CurrentUsername = ViewBag.Username as string;
    var CurrentUserid = ViewBag.UserId as int?;
    var message = ViewBag.SuccessMessage as string;
    var currentPage = Model.CurrentPage; // Store the current page number for use in JavaScript
    var totalPages = Model.TotalPages; // Store total pages for use in JavaScript
}

<script>
    var currentUsername = '@Html.Raw(CurrentUsername)';

    // Check username in session storage
    const storedUsername = sessionStorage.getItem('currentUsername');
    if (!storedUsername) {
        if (currentUsername) {
            sessionStorage.setItem('currentUsername', currentUsername);
        } else {
            console.log('Username is not available.');
        }
    }

    function delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    document.addEventListener('DOMContentLoaded', async function () {
        var PromptMsg = document.getElementById('prompt-message');
        var message = '@Html.Raw(message)'.trim();
        if (message.trim() !== '') {
            PromptMsg.textContent = message;
        }
        if (PromptMsg) {
            await delay(2000);
            PromptMsg.style.display = 'none';
        }
    });

    var currentPage = @currentPage;  // Current page number
    var totalPages = @totalPages;    // Total number of pages

    function updatePagination() {
        // Update "Previous" button
        if (currentPage <= 1) {
            $('.pagination .prev').addClass('disabled').attr('href', '#').off('click');
        } else {
            $('.pagination .prev').removeClass('disabled').attr('href', '#').on('click', function (e) {
                e.preventDefault();
                loadItems(currentPage - 1);
            });
        }

        // Update "Next" button
        if (currentPage >= totalPages) {
            $('.pagination .next').addClass('disabled').attr('href', '#').off('click');
        } else {
            $('.pagination .next').removeClass('disabled').attr('href', '#').on('click', function (e) {
                e.preventDefault();
                loadItems(currentPage + 1);
            });
        }

        // Highlight the current page
        $('.pagination a').removeClass('active');
        $('.pagination a').each(function () {
            var href = $(this).attr('href');
            var page = new URLSearchParams(href.split('?')[1]).get('page');
            if (parseInt(page) === currentPage) {
                $(this).addClass('active');
            }
        });
    }

    function loadItems(page) {
        $.ajax({
            url: '@Url.Action("ItemTable", "Users")',
            data: { page: page },
            success: function (data) {
                $('#view-all').html(data);
                currentPage = page;  // Update currentPage
                updatePagination();
            },
            error: function (xhr) {
                console.error(xhr);
            }
        });
    }

    $(document).ready(function () {
        // Initialize pagination on page load
        updatePagination();

        // Handle pagination clicks
        $(document).on('click', '.pagination a:not(.disabled)', function (e) {
            e.preventDefault();
            var href = $(this).attr('href');
            var page = new URLSearchParams(href.split('?')[1]).get('page');
            if (page) {
                loadItems(parseInt(page));
            }
        });
    });
</script>


<!-- Main Content Area -->
<div id="main-content" class="d-flex flex-column">
    <!-- Sidebar Navigation -->
    <nav id="sidebar" class="bg-dark text-white">
        <h3 class="text-success">Dashboard</h3>
        <ul class="nav flex-column">
            <li class="nav-item">
                <button class="btn btn-success" onclick="ShowModal('@Url.Action("AddItem", "Users")')">Add New Item</button>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" href="#">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" href="#">Settings</a>
            </li>

        </ul>
    </nav>

    <!-- Top Bar -->
    <div id="top-bar" class="d-flex justify-content-between ps-2 pe-2 bg-dark text-white">
        <a href="#" class="text-decoration-none mt-2 text-light text-uppercase ms-1">@CurrentUsername</a>
        <div class="d-flex align-items-center">
            <button class="btn btn-danger" onclick="LogoutRequest('@CurrentUserid', '@CurrentUsername')">Logout</button>
        </div>
    </div>

    <!-- Content -->
    <div class="mt-3">
        <div id="view-all" class="container-fluid p-0">
            @await Html.PartialAsync("ItemTable", Model)
        </div>

        <!-- Pagination -->
        <div class="pagination mt-3">
            @if (Model.CurrentPage > 1)
            {
                <a href="@Url.Action("ItemTable", new { page = Model.CurrentPage - 1 })" class="prev">Previous</a>
            }
            else
            {
                <a href="#" class="prev disabled">Previous</a>
            }

            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <a href="@Url.Action("ItemTable", new { page = i })" class="@(Model.CurrentPage == i ? "active" : "")">@i</a>
            }

            @if (Model.CurrentPage < Model.TotalPages)
            {
                <a href="@Url.Action("ItemTable", new { page = Model.CurrentPage + 1 })" class="next">Next</a>
            }
            else
            {
                <a href="#" class="next disabled">Next</a>
            }
        </div>

    </div>
</div>


@section Scripts { }
